---
title: "Balcewicz HW 3"
author: "Katie Balcewicz"
date: "1/30/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Univariate Assignment

Read in tree data, metadata can be found in: ./data/tree_metadata.txt
```{r}
trees = read.csv("https://raw.githubusercontent.com/dmcglinn/quant_methods/gh-pages/data/treedata_subset.csv", 
                 header = TRUE)
acer = subset(trees, species == "Acer rubrum")
abies = subset(trees, species == "Abies fraseri")
```

## 1. Exploratory analysis
```{r}
str(acer)
str(abies)
```
```{r}
hist(acer$cover)
hist(abies$cover)
```

```{r}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor=3, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) 
        cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor)
}
pairs(acer[,c("cover", "elev", "tci", "streamdist", "disturb", "beers")], 
      lower.panel = panel.smooth, upper.panel = panel.cor)
pairs(abies[,c("cover", "elev", "tci", "streamdist", "disturb", "beers")], 
      lower.panel = panel.smooth, upper.panel = panel.cor)
```



```{r}
lm.acer = lm(cover ~ elev + tci + streamdist + disturb + beers, data = acer)
summary(lm.acer)
lm.abies = lm(cover ~ elev + tci + streamdist + disturb + beers, data = abies)
summary(lm.abies)
```

```{r}
library(car)
Anova(lm.acer, type = 3)
Anova(lm.abies, type = 3)
```
 The p-values generate by the Anova function are the same as those generated by the lm function.

```{r}
library(MASS)
step.acer =  stepAIC(lm.acer)
step.abies = stepAIC(lm.abies)
```

```{r}
summary(step.acer)
summary(step.abies)
```

```{r}
plot(step.acer)
plot(step.abies)
```

    The Acer rubrum model has a multiple r-squared value of 0.04174, indicating that only 4.174% of the variation in cover can be explained by the explanatory variables. The variables that were included in the stepwise regression, and thus the most important variables, are elev, tci, streamdist, and beers. Model diagnostics plots indicate that there are no major violations of the OLS assumptions. 
    The Abies fraseri model has a multiple r-squared value of 0.5204, indicating that 52.04% of the variation in cover can be explained by the explanatory variables. The variables that were included in the stepwise regression, and thus the most important variables, are elev and tci. Model diagnostics plots indicate that there are no major violatuins of the OLS assumptions.
    Between the two models, the variance in Abies fraseri cover is much better explained by the data. This is possibly because it is a habitat specialist and there is less variation in the range of habitats for which the model must make predictions. 
 
## 2. General Linear Model (GLM) with a Poisson error term 
```{r}
acer_glm = glm(cover ~ elev + tci + streamdist + beers , data = acer, 
                family = 'poisson')
abies_glm = glm(cover ~ elev + tci, data = abies, family = 'poisson')

pseudo_r2 = function(glm_mod) {
     1 -  glm_mod$deviance / glm_mod$null.deviance
}

acer_r2 = pseudo_r2(acer_glm)
acer_r2

abies_r2 = pseudo_r2(abies_glm)
abies_r2
```

```{r}
anova(step.acer, acer_glm)
anova(step.abies, abies_glm)
```

